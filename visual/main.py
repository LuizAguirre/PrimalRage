import pygameimport randomimport jsonimport osimport mathfrom math import sin# ----------------------------# CONFIGURA√á√ïES GERAIS# ----------------------------WIDTH, HEIGHT = 800, 600FPS = 60HIGHSCORES_FILE = "highscores.json"SAVE_FILE = "savegame.json"WHITE = (255, 255, 255)BLACK = (0, 0, 0)RED = (255, 0, 0)GREEN = (0, 255, 0)pygame.init()pygame.mixer.init()screen = pygame.display.set_mode((WIDTH, HEIGHT))pygame.display.set_caption("ü¶ç PRIMAL RAGE")clock = pygame.time.Clock()font = pygame.font.Font(None, 32)# Timer fase 2phase2_timer_active = Falsephase2_start_time = 0phase2_duration_ms = 3 * 60 * 1000  # 3 minutosphase2_timer_finished = False# ----------------------------# ASSETS# ----------------------------ASSETS = {    "introducao": "introducao",    "player": "gorila",    "meteor": "coco",    "projectile": "banana_1",    "boss": "chefe1",    "boss2": "chefe2",    "boss3": "chefe3",}ASSET_CACHE = {}def load_image_auto(base_name, colorkey=None, size=None):    if base_name in ASSET_CACHE:        return ASSET_CACHE[base_name]    possible_exts = ["", ".png", ".jpg", ".jpeg"]    for ext in possible_exts:        path = base_name + ext        if os.path.exists(path):            try:                img = pygame.image.load(path).convert_alpha()                if colorkey is not None:                    img = img.convert()                    img.set_colorkey(colorkey)                if size:                    img = pygame.transform.scale(img, size)                ASSET_CACHE[base_name] = img                return img            except Exception as e:                print("Erro ao carregar", path, e)                continue    print(f"‚ö†Ô∏è Imagem '{base_name}' n√£o encontrada. Placeholder criado")    surf = pygame.Surface(size if size else (50, 50), pygame.SRCALPHA)    surf.fill((255, 0, 255))    ASSET_CACHE[base_name] = surf    return surf# ----------------------------# SONS# ----------------------------# M√∫sicas por fase e ambienteMUSIC_PHASES = {    1: "fase1_music.mp3",    2: "fase2_music.mp3",    3: "fase3_music.mp3",}AMBIENT_MUSIC = "som_ambiente.mp3"def _safe_play_music(filename, loop=True, volume=0.45):    try:        if not os.path.exists(filename):            print(f"[music] arquivo n√£o encontrado: {filename}")            return False        pygame.mixer.music.stop()        try:            if hasattr(pygame.mixer.music, "unload"):                pygame.mixer.music.unload()        except:            pass        pygame.mixer.music.load(filename)        pygame.mixer.music.set_volume(volume)        pygame.mixer.music.play(-1 if loop else 0)        return True    except Exception as e:        print(f"[music] erro ao tocar {filename}: {e}")        return Falsetry:    som_meteoro_normal = pygame.mixer.Sound("som_meteoro_normal.mp3")    som_meteoro_normal.set_volume(0.7)except:    som_meteoro_normal = Nonetry:    som_meteoro_mortal = pygame.mixer.Sound("som_meteoro_mortal.mp3")    som_meteoro_mortal.set_volume(0.7)except:    som_meteoro_mortal = Nonetry:    som_meteoro_powerup = pygame.mixer.Sound("som_meteoro_powerup.mp3")    som_meteoro_powerup.set_volume(0.7)except:    som_meteoro_powerup = Nonetry:    som_meteoro_vidas_extras = pygame.mixer.Sound("som_meteoro_vidas_extra.mp3")    som_meteoro_vidas_extras.set_volume(0.7)except:    som_meteoro_vidas_extras = Nonetry:    som_meteoro_invulneravel = pygame.mixer.Sound("som_meteoro_invulneravel.mp3")    som_meteoro_invulneravel.set_volume(0.7)except:    som_meteoro_invulneravel = Nonetry:    som_tiro_meteoro = pygame.mixer.Sound("banana_atinge.mp3")    som_tiro_meteoro.set_volume(0.7)except:    som_tiro_meteoro = Noneboss_sounds = {}for i, fname in [(1, "boss_rugido_f1.mp3"), (2, "boss_rugido_f2.wav"), (3, "boss_rugido_f3.wav")]:    try:        s = pygame.mixer.Sound(fname)        s.set_volume(0.7)        boss_sounds[i] = s    except Exception as e:        print("Erro boss sound", fname, e)        boss_sounds[i] = Nonedef play_phase_music(phase):    fname = MUSIC_PHASES.get(phase)    if fname:        ok = _safe_play_music(fname, loop=True, volume=0.45)        if not ok:            pygame.mixer.music.stop()def play_ambient_music():    _safe_play_music(AMBIENT_MUSIC, loop=True, volume=0.55)# Tocar som ambiente inicialmenteplay_ambient_music()# ----------------------------# CLASSES DO JOGO# ----------------------------class Player:    def __init__(self, x, y):        try:            self.frames_right = self.cut_frames("gorila1direita.png")            self.frames_left = self.cut_frames("gorila1esquerda.png")        except Exception as e:            print("Erro ao carregar sheets de player:", e)            self.frames_right = [load_image_auto("gorila", None, (80,60))]            self.frames_left = [load_image_auto("gorila", None, (80,60))]        self.front_img = load_image_auto("gorila.png", (255,255,255), (80,60))        self.down_img = load_image_auto("gorila.png", (255,255,255), (80,60))        self.image = self.front_img        self.rect = self.image.get_rect(center=(x,y))        self.speed = 7        self.frame_index = 0        self.last_frame_time = 0        self.frame_delay = 100        self.invulneravel = False        self.inv_time = 0        self.escudo = False        # hit flash        self.hit_flash = False        self.hit_time = 0        self.hit_duration = 200  # ms    def cut_frames(self, sheet_name):        sheet = pygame.image.load(sheet_name).convert()        sheet.set_colorkey((255,255,255))        frames = []        total_frames = 4        frame_width = sheet.get_width() // total_frames        frame_height = sheet.get_height()        for i in range(total_frames):            frame = sheet.subsurface(pygame.Rect(i*frame_width,0,frame_width,frame_height))            frame = pygame.transform.scale(frame,(80,60))            frames.append(frame)        return frames    def move(self, keys, mouse_pos=None):        moving = False        if keys[pygame.K_a]:            self.rect.x -= self.speed            self.image = self.frames_left[self.frame_index]            moving = True        elif keys[pygame.K_d]:            self.rect.x += self.speed            self.image = self.frames_right[self.frame_index]            moving = True        elif keys[pygame.K_w]:            self.rect.y -= self.speed            self.image = self.front_img        elif keys[pygame.K_s]:            self.rect.y += self.speed            self.image = self.down_img        else:            self.image = self.front_img        if mouse_pos:            self.rect.center = mouse_pos        # limites        self.rect.x = max(0, min(self.rect.x, WIDTH - self.rect.width))        self.rect.y = max(0, min(self.rect.y, HEIGHT - self.rect.height))        # frame update        now = pygame.time.get_ticks()        if moving:            if now - self.last_frame_time > self.frame_delay:                self.frame_index = (self.frame_index +1) % len(self.frames_right)                self.last_frame_time = now        else:            self.frame_index = 0    def was_hit(self):        """Chame quando o player √© atingido por um meteoro 'normal' (sem efeito)."""        self.hit_flash = True        self.hit_time = pygame.time.get_ticks()    def draw(self, surf):        surf.blit(self.image, self.rect)        if self.hit_flash:            now = pygame.time.get_ticks()            if now - self.hit_time <= self.hit_duration:                overlay = pygame.Surface((WIDTH, HEIGHT), pygame.SRCALPHA)                alpha = int(120 * (1 - (now - self.hit_time) / self.hit_duration))                overlay.fill((255, 0, 0, alpha))                surf.blit(overlay, (0,0))            else:                self.hit_flash = False# ----------------------------# PROJ√âTEIS, METEOROS E BOSS# ----------------------------class Projectile:    def __init__(self, x, y):        self.image = load_image_auto(ASSETS["projectile"], (255,255,255),(40,40))        self.rect = self.image.get_rect(center=(x,y))        self.speed = 5    def update(self):        self.rect.y -= self.speed        return self.rect.y < -40class Meteor:    def __init__(self, x, y, speed, tipo="normal"):        self.rect = pygame.Rect(x, y, 40, 40)        self.speed = speed        self.tipo = tipo        self.hits = 1        # Cooldown de colis√£o        self.last_hit_time = 0  # timestamp do √∫ltimo hit        self.hit_cooldown = 200  # em ms, tempo m√≠nimo entre hits        # imagens        if tipo == "normal":            self.image = load_image_auto(ASSETS["meteor"], (255,255,255),(40,40))        elif tipo == "mortal":            self.image = load_image_auto("meteoro_mortal", (255,255,255),(50,50))        elif tipo == "invulneravel":            self.image = load_image_auto("banana_power", (255,255,255),(50,50))        elif tipo == "powerup":            self.image = load_image_auto("banana_shield", (255,255,255),(50,50))        elif tipo == "vidas_extra":            self.image = load_image_auto("banana_vida", (255,255,255),(50,50))        else:            self.image = load_image_auto(ASSETS["meteor"], (255,255,255),(40,40))    def update(self):        self.rect.y += self.speed    def reset(self):        self.rect.y = random.randint(-200, -40)        self.rect.x = random.randint(0, WIDTH - self.rect.width)        self.speed = random.randint(3,5)        if self.tipo == "mortal":            self.speed += 2class BossGorila(pygame.sprite.Sprite):    def __init__(self, health, normal_img, rage_img):        super().__init__()        self.image_normal = normal_img        self.image_rage = rage_img        self.image = self.image_normal        self.rect = self.image.get_rect(center=(WIDTH//2,120))        self.health = health        self.max_health = health        self.speed_x = 3        self.rage = False    def entrar_em_rage(self):        self.rage = True        self.image = self.image_rage        self.speed_x = 5    def update(self):        self.rect.x += self.speed_x        if self.rect.right >= WIDTH or self.rect.left <=0:            self.speed_x *= -1# ----------------------------# ANIMA√á√ïES DE VIT√ìRIA/DERROTA# ----------------------------class Animation:    def __init__(self, sprite_sheet, total_frames, scale=None):        self.total_frames = total_frames        self.frames = []        sheet_width = sprite_sheet.get_width()        sheet_height = sprite_sheet.get_height()        frame_width = max(1, sheet_width // total_frames)        # Recorta os frames        for i in range(total_frames):            frame = sprite_sheet.subsurface((i * frame_width, 0, frame_width, sheet_height))            if scale:                frame = pygame.transform.scale(frame, scale)            self.frames.append(frame)    def get_frame(self, index):        return self.frames[index]def animacao_final(animation, is_win=False):    """    Toca a anima√ß√£o (frame a frame). Depois de terminado:    - mostra op√ß√£o T para voltar ao menu (retorna)    - ESC sai do jogo    - se is_win False -> mostra 'GAME OVER' tremendo (em vermelho)    - se is_win True  -> mostra 'VIT√ìRIA!!' pulando    """    play_ambient_music()    clock_local = pygame.time.Clock()    frame_index = 0    anim_fps = 8  # frames por segundo da anima√ß√£o    ms_per_frame = int(1000 / anim_fps)    last_frame_time = pygame.time.get_ticks()    finished = False    text_jump_phase = 0.0    fonte_titulo = pygame.font.Font(None, 72)    instrucoes_font = pygame.font.Font(None, 32)    while True:        for ev in pygame.event.get():            if ev.type == pygame.QUIT:                pygame.quit()                exit()            if ev.type == pygame.KEYDOWN and finished:                if ev.key == pygame.K_t:                    return                if ev.key == pygame.K_ESCAPE:                    pygame.quit()                    exit()        now = pygame.time.get_ticks()        if not finished and now - last_frame_time >= ms_per_frame:            frame_index += 1            last_frame_time = now            if frame_index >= animation.total_frames:                frame_index = animation.total_frames - 1                finished = True        screen.fill(BLACK)        frame = animation.get_frame(frame_index)        fx = (WIDTH - frame.get_width()) // 2        fy = (HEIGHT - frame.get_height()) // 2        screen.blit(frame, (fx, fy))        if finished:            if is_win:                text_jump_phase += 0.12                jump = int(18 * abs(sin(text_jump_phase)))                texto = fonte_titulo.render("VIT√ìRIA!!", True, GREEN)                tx = WIDTH//2 - texto.get_width()//2                ty = fy - 80 - jump                screen.blit(texto, (tx, ty))            else:                shake = int(6 * math.sin(pygame.time.get_ticks() * 0.01))                texto = fonte_titulo.render("GAME OVER", True, RED)                tx = WIDTH//2 - texto.get_width()//2 + shake                ty = fy - 80                screen.blit(texto, (tx, ty))            texto1 = instrucoes_font.render("Pressione T para voltar ao in√≠cio", True, WHITE)            texto2 = instrucoes_font.render("Pressione ESC para sair", True, WHITE)            screen.blit(texto1, (WIDTH//2 - texto1.get_width()//2, HEIGHT - 120))            screen.blit(texto2, (WIDTH//2 - texto2.get_width()//2, HEIGHT - 80))        pygame.display.flip()        clock_local.tick(FPS)# ----------------------------# FUN√á√ïES DE FASE, SAVE E HIGHSCORES# ----------------------------phase_data = {    1: {"background":"fase_1","meteor_speed":5,"meteor_count":5,"boss_health":20,"meteoros_necessarios":20},    2: {"background":"fase_2","meteor_speed":7,"meteor_count":8,"boss_health":30,"meteoros_necessarios":30},    3: {"background":"fase_3","meteor_speed":9,"meteor_count":10,"boss_health":40,"meteoros_necessarios":40}}background = Nonemeteor_list = []projectiles = []boss_group = pygame.sprite.Group()boss_active = Falseboss_rage = Falsemeteoros_destruidos = 0score = 0lives = 3current_phase = 1rage_trigger = 0.3# ----------------------------# SAVE / LOAD# ----------------------------def salvar_jogo(player):    boss = next(iter(boss_group.sprites()),None)    data = {        "player":{"x":player.rect.x,"y":player.rect.y,"lives":lives,"score":score},        "fase":{"current_phase":current_phase,"meteoros_destruidos":meteoros_destruidos},        "meteoros":[{"x":m.rect.x,"y":m.rect.y,"speed":m.speed,"tipo":m.tipo,"hits":m.hits} for m in meteor_list],        "boss":{"active":boss_active,"health":boss.health if boss else 0,"x":boss.rect.x if boss else 0,"y":boss.rect.y if boss else 0,"rage":boss.rage if boss else False}    }    with open(SAVE_FILE,"w") as f:        json.dump(data,f,indent=4)    print("üíæ Jogo salvo!")def carregar_jogo(player):    global lives, score, current_phase, meteoros_destruidos, meteor_list, boss_group, boss_active    if not os.path.exists(SAVE_FILE):        print("Nenhum save encontrado.")        return False    with open(SAVE_FILE,"r") as f:        data = json.load(f)    # player    player.rect.x = data["player"]["x"]    player.rect.y = data["player"]["y"]    lives = data["player"]["lives"]    score = data["player"]["score"]    # fase    current_phase = data["fase"]["current_phase"]    meteoros_destruidos = data["fase"]["meteoros_destruidos"]    carregar_fase(current_phase, resetar=False)    # meteoros    meteor_list.clear()    for m in data["meteoros"]:        meteor_list.append(Meteor(m["x"],m["y"],m["speed"],m["tipo"]))    # boss    boss_group.empty()    boss_info = data["boss"]    boss_active = boss_info["active"]    if boss_active:        dados = phase_data[current_phase]        if current_phase ==1:            boss = BossGorila(dados["boss_health"], load_image_auto(ASSETS["boss"],(255,255,255),(200,150)), load_image_auto("chefe1_rage",(255,255,255),(200,150)))        elif current_phase==2:            boss = BossGorila(dados["boss_health"], load_image_auto(ASSETS["boss2"],(255,255,255),(200,150)), load_image_auto("chefe2_rage",(255,255,255),(200,150)))        else:            boss = BossGorila(dados["boss_health"], load_image_auto(ASSETS["boss3"],(255,255,255),(200,150)), load_image_auto("chefe3_rage",(255,255,255),(200,150)))        boss.health = boss_info["health"]        boss.rect.x = boss_info["x"]        boss.rect.y = boss_info["y"]        boss.rage = boss_info.get("rage",False)        boss_group.add(boss)    return True# ----------------------------# FUN√á√ïES DE HIGH SCORES# ----------------------------def carregar_highscores():    if not os.path.exists(HIGHSCORES_FILE):        return []    try:        with open(HIGHSCORES_FILE,"r") as f:            return json.load(f)    except:        return []def salvar_highscores(scores):    with open(HIGHSCORES_FILE,"w") as f:        json.dump(scores,f,indent=4)def registrar_score(score_atual):    scores = carregar_highscores()    scores.append(score_atual)    scores = sorted(scores, reverse=True)[:5]    salvar_highscores(scores)def formatar_scores():    scores = carregar_highscores()    if not scores:        return ["Nenhum score salvo ainda."]    return [f"{i+1}¬∫ - {s} pontos" for i,s in enumerate(scores)]# ----------------------------# FUN√á√ÉO PARA CARREGAR FASE# ----------------------------def carregar_fase(n, resetar=True):    global background, meteor_list, projectiles, boss_active, boss_rage, current_phase, phase2_timer_active, phase2_start_time, phase2_timer_finished    current_phase = n    dados = phase_data[n]    background = load_image_auto(dados["background"], None, (WIDTH, HEIGHT))    # play fase m√∫sica    play_phase_music(n)    # Timer da FASE 2    if n == 2:        phase2_timer_active = True        phase2_timer_finished = False        phase2_start_time = pygame.time.get_ticks()    else:        phase2_timer_active = False    if resetar:        meteor_list.clear()        projectiles.clear()        boss_group.empty()        boss_active = False        boss_rage = False        # FASE 3: TODOS meteoros s√£o mortais        if n == 3:            for _ in range(dados["meteor_count"]):                x = random.randint(0, WIDTH - 40)                y = random.randint(-500, -40)                speed = random.randint(3, dados["meteor_speed"])                meteor_list.append(Meteor(x, y, speed, "mortal"))        else:            # Fases 1 e 2 normais            for _ in range(dados["meteor_count"]):                x = random.randint(0, WIDTH - 40)                y = random.randint(-500, -40)                speed = random.randint(3, dados["meteor_speed"])                meteor_list.append(Meteor(x, y, speed, "normal"))        meteor_list.append(Meteor(random.randint(0, WIDTH-40), random.randint(-500, -40), random.randint(3,dados["meteor_speed"]), "mortal"))        meteor_list.append(Meteor(random.randint(0, WIDTH-40), random.randint(-500, -40), random.randint(3,dados["meteor_speed"]), "invulneravel"))        meteor_list.append(Meteor(random.randint(0, WIDTH-40), random.randint(-500, -40), random.randint(3,dados["meteor_speed"]), "powerup"))        meteor_list.append(Meteor(random.randint(0, WIDTH-40), random.randint(-500, -40), random.randint(3,dados["meteor_speed"]), "vidas_extra"))    print(f"--- FASE {n} CARREGADA ---")# ----------------------------# TELA INICIAL# ----------------------------intro_image = load_image_auto("introducao.png", None, (WIDTH,HEIGHT))def tela_inicial(player):    global current_phase    fonte = pygame.font.Font(None,32)    play_ambient_music()    esperando = True    while esperando:        screen.fill(BLACK)        screen.blit(intro_image, intro_image.get_rect(center=(WIDTH//2, HEIGHT//2)))        scores = formatar_scores()        y = 20        screen.blit(font.render("‚≠ê HIGH SCORES ‚≠ê",True,(255,255,0)),(20,y))        y += 40        for s in scores:            screen.blit(font.render(s,True,(255,255,255)),(20,y))            y += 30        screen.blit(fonte.render("ENTER - Novo Jogo",True,(255,255,255)),(WIDTH//2 - 100, HEIGHT-80))        if os.path.exists(SAVE_FILE):            screen.blit(fonte.render("C - Continuar",True,(255,255,0)),(WIDTH//2 - 100, HEIGHT-50))        pygame.display.flip()        for event in pygame.event.get():            if event.type == pygame.QUIT:                pygame.quit()                exit()            if event.type == pygame.KEYDOWN:                if event.key == pygame.K_RETURN:                    carregar_fase(1)                    esperando = False                if event.key == pygame.K_c:                    if carregar_jogo(player):                        esperando = False                if event.key == pygame.K_F5:                    salvar_jogo(player)                if event.key == pygame.K_F9:                    carregar_jogo(player)                    carregar_fase(current_phase)                    esperando = False# ----------------------------# INST√ÇNCIAS INICIAIS# ----------------------------player = Player(WIDTH//2, HEIGHT-60)carregar_fase(1)tela_inicial(player)# ============================================================# LOOP GERAL DO JOGO (ARCADE) - PERMITE REINICIAR SEM FECHAR# ============================================================while True:    game_over = False    game_win = False    last_shot_time = 0    shot_cooldown = 400    player = Player(WIDTH // 2, HEIGHT - 60)    carregar_fase(1)    tela_inicial(player)    score = 0    lives = 3    current_phase = 1    meteoros_destruidos = 0    boss_group.empty()    boss_active = False    boss_rage = False    projectiles.clear()    running = True    while running:        clock.tick(FPS)        keys = pygame.key.get_pressed()        mouse_pos = pygame.mouse.get_pos() if pygame.mouse.get_pressed()[0] else None        player.move(keys, mouse_pos)        for event in pygame.event.get():            if event.type == pygame.QUIT:                pygame.quit()                exit()            if event.type == pygame.KEYDOWN:                if event.key == pygame.K_SPACE:                    now = pygame.time.get_ticks()                    if now - last_shot_time >= shot_cooldown:                        projectiles.append(Projectile(player.rect.centerx, player.rect.top))                        last_shot_time = now                if event.key == pygame.K_F5:                    salvar_jogo(player)                if event.key == pygame.K_F9:                    carregar_jogo(player)        # Atualiza meteoros        # Dentro do loop de atualiza√ß√£o de meteoros        for m in meteor_list:            m.update()            # colis√£o com player            # Colis√£o com player            now = pygame.time.get_ticks()            if player.rect.colliderect(m.rect):                now = pygame.time.get_ticks()                if now - getattr(m, "last_hit_time", 0) > getattr(m, "hit_cooldown", 0):                    m.last_hit_time = now  # atualiza o tempo do √∫ltimo hit                    if m.tipo == "normal":                        if not player.invulneravel:                            lives -= 1                            player.was_hit()                            if som_meteoro_normal:                                som_meteoro_normal.play()                    elif m.tipo == "mortal":                        if not player.invulneravel:                            lives -= 3                            if som_meteoro_mortal:                                som_meteoro_mortal.play()                    elif m.tipo == "invulneravel":                        player.invulneravel = True                        player.inv_time = pygame.time.get_ticks()                        if som_meteoro_invulneravel:                            som_meteoro_invulneravel.play()                    elif m.tipo == "powerup":                        player.escudo = True                        if som_meteoro_powerup:                            som_meteoro_powerup.play()                    elif m.tipo == "vidas_extra":                        lives += 2                        if som_meteoro_vidas_extras:                            som_meteoro_vidas_extras.play()                    # **Reset do meteoro sempre ap√≥s bater**                    m.reset()                    if lives <= 0:                        game_over = True                        running = False            # colis√£o com proj√©til            for proj in projectiles.copy():                proj.update()                if proj.rect.y < -40:                    projectiles.remove(proj)                    continue                if m.rect.colliderect(proj.rect):                    projectiles.remove(proj)                    if som_tiro_meteoro:                        som_tiro_meteoro.play()  # toca som sempre que o proj√©til acerta                    if m.hits > 1:                        m.hits -= 1                        continue                    m.reset()                    score += 5                    meteoros_destruidos += 1                if lives <= 0:                    game_over = True                    running = False            for proj in projectiles.copy():                proj.update()                if proj.rect.y < -40:                    projectiles.remove(proj)                    continue                if m.rect.colliderect(proj.rect):                    projectiles.remove(proj)                    try:                        if som_tiro_meteoro:                            som_tiro_meteoro.play()                    except:                        pass                    if m.hits > 1:                        m.hits -= 1                        continue                    m.reset()                    score += 5                    meteoros_destruidos += 1            if m.rect.y > HEIGHT:                m.reset()                score += 1        # Spawn boss (bloqueado em fase2 enquanto timer estiver ativo)        dados = phase_data[current_phase]        # calcula remaining se fase2        now_ms = pygame.time.get_ticks()        remaining_ms = 0        if current_phase == 2 and phase2_timer_active:            elapsed = now_ms - phase2_start_time            remaining_ms = max(0, phase2_duration_ms - elapsed)            # se tempo acabou, troca para fase 3            if remaining_ms == 0:                current_phase = 3                carregar_fase(3)                meteoros_destruidos = 0                remaining_ms = 0        spawn_boss = False        # FASE 2: s√≥ aparece boss depois do timer zerar        if current_phase == 2:            if phase2_timer_active:                elapsed = pygame.time.get_ticks() - phase2_start_time                remaining = phase2_duration_ms - elapsed                if remaining <= 0 and not phase2_timer_finished:                    phase2_timer_finished = True                    phase2_timer_active = False                    spawn_boss = True  # Ativa boss imediatamente            else:                # Timer j√° acabou e boss ainda n√£o apareceu                if not boss_active and not phase2_timer_finished:                    spawn_boss = True        else:            # Fases 1 e 3 mant√™m a l√≥gica padr√£o            if meteoros_destruidos >= dados["meteoros_necessarios"]:                spawn_boss = True        # Criar boss        if spawn_boss and not boss_active:            if current_phase == 1:                boss = BossGorila(dados["boss_health"],                                  load_image_auto(ASSETS["boss"], (255, 255, 255), (200, 150)),                                  load_image_auto("chefe1_rage", (255, 255, 255), (200, 150)))            elif current_phase == 2:                boss = BossGorila(dados["boss_health"],                                  load_image_auto(ASSETS["boss2"], (255, 255, 255), (200, 150)),                                  load_image_auto("chefe2_rage", (255, 255, 255), (200, 150)))            else:                boss = BossGorila(dados["boss_health"],                                  load_image_auto(ASSETS["boss3"], (255, 255, 255), (200, 150)),                                  load_image_auto("chefe3_rage", (255, 255, 255), (200, 150)))            boss_group.add(boss)            boss_active = True        # Atualiza boss        if boss_active:            for boss in boss_group:                if not boss.rage and boss.health <= boss.max_health * rage_trigger:                    boss.entrar_em_rage()                    sfx = boss_sounds.get(current_phase)                    if sfx:                        sfx.play()                for proj in projectiles.copy():                    if boss.rect.colliderect(proj.rect):                        projectiles.remove(proj)                        boss.health -= 1                        if boss.health <= 0:                            boss_group.remove(boss)                            boss_active = False                            meteoros_destruidos = 0                            if current_phase < 3:                                current_phase += 1                                carregar_fase(current_phase)                            else:                                game_win = True                                running = False        # Invulnerabilidade expira        if player.invulneravel and pygame.time.get_ticks() - player.inv_time > 5000:            player.invulneravel = False        # DESENHO        screen.blit(background, (0, 0))        player.draw(screen)        for m in meteor_list:            screen.blit(m.image, m.rect)        for proj in projectiles:            screen.blit(proj.image, proj.rect)        boss_group.update()        boss_group.draw(screen)        # Barra do boss        for boss in boss_group:            barra_total = 200            barra_altura = 15            perc = boss.health / boss.max_health if boss.max_health > 0 else 0            pygame.draw.rect(screen, RED,                             (boss.rect.centerx - barra_total // 2, boss.rect.top - 20, barra_total, barra_altura))            pygame.draw.rect(screen, GREEN,                             (boss.rect.centerx - barra_total // 2, boss.rect.top - 20, int(barra_total * perc),                              barra_altura))        # HUD        screen.blit(font.render(f"Pontos: {score}  Vidas: {lives}", True, WHITE), (10, 10))        screen.blit(font.render(f"Fase: {current_phase}", True, WHITE), (10, 40))        # TIMER FASE 2        if current_phase == 2 and phase2_timer_active:            elapsed = pygame.time.get_ticks() - phase2_start_time            remaining = max(0, phase2_duration_ms - elapsed)            seconds = remaining // 1000            mm = seconds // 60            ss = seconds % 60            timer_text = font.render(f"{mm:02d}:{ss:02d}", True, (255, 255, 0))            screen.blit(timer_text, (WIDTH - 120, 10))        pygame.display.flip()    # ======================================================    #  ANIMA√á√ÉO FINAL ‚Äî E LOOPA DE VOLTA PARA A TELA INICIAL    # ======================================================    if game_over:        derrota_anim = Animation(load_image_auto("derrota.png"), total_frames=4, scale=(800, 600))        animacao_final(derrota_anim, is_win=False)        registrar_score(score)    elif game_win:        victory_anim = Animation(load_image_auto("vitoria.png"), total_frames=5, scale=(800, 600))        animacao_final(victory_anim, is_win=True)        registrar_score(score)# EOF